"use strict";function GetRequest(){var a=location.href,e=new Object;if(-1!=a.indexOf("?"))for(var t=a.substr(a.indexOf("?")+1).split("&"),n=0;n<t.length;n++)e[t[n].split("=")[0]]=unescape(t[n].split("=")[1]);return e}function renderData(a,e,t){t.length>0?laytpl(e).render(t,function(e){a.html(e)}):a.html("暂无数据")}function getuserInfo(){var a=localStorage.getItem("userInfo")||null,e=new Object;if(a)try{e=JSON.parse(a)}catch(a){console.log("用户信息格式有误!"),e=null}return e}function setLocal(a,e){localStorage.setItem(a,JSON.stringify(e))}function getLocal(a,e){var t=localStorage.getItem(a)||null,n=new Object;if(t){if(1==e)try{n=JSON.parse(t)}catch(e){console.log("Key为"+a+"的本地存储信息格式有误","错误信息为:"+e)}}else console.log("没有找到key为"+a+"的本地存储信息 ");return n}function clearSessionStorage(){sessionStorage.clear()}function skip(a,e,t){a&&(e<t.activeIndex?t.isEnd?t.slideTo(e,0,!0):t.slideTo(t.activeIndex+1,0,!0):t.slideTo(t.activeIndex-1,0,!0),oddActiveIndex=t.activeIndex)}function animateSwiper(){$("#loading").css({display:"none"}),$(".ishow").css({display:"block"});var a=new Swiper(".swiper-container",{observer:!0,observeParents:!0,pagination:".swiper-pagination",paginationClickable:!0,direction:"vertical",onInit:function(a){swiperAnimateCache(a),swiperAnimate(a)},onSlideChangeEnd:function(a){swiperAnimate(a),1==a.activeIndex?skip(!dataObj.aaData.ncqh[0],oddActiveIndex,a):2==a.activeIndex?skip(!dataObj.aaData.nw.length>0,oddActiveIndex,a):3==a.activeIndex&&skip(!dataObj.aaData.ltxx.length>0,oddActiveIndex,a),0==a.activeIndex?(dataObj.aaData.ltxx.length>0&&dataObj.aaData.ncqh[0]&&dataObj.aaData.nw.length>0&&$(".upload .ani").attr({"swiper-animate-delay":$(".upload .ani").attr("swiper-animate-delay").split("s")[0]-2+"s"}),(dataObj.aaData.ltxx.length>0||dataObj.aaData.ncqh[0]||dataObj.aaData.nw.length>0)&&($("#dy_img").addClass("dy_img animateTimeImg"),$("#dy_name").addClass("dy_name animateTimeName")),setTimeout(function(){$(".amap-icon").css({display:"none"}),$("#areaName").css({display:"none"})},3100)):($(".first .ani").attr({"swiper-animate-delay":"3.2s"}),$(".first .amap-icon").attr("swiper-animate-duratio","2s"),$(".first .amap-icon").attr("swiper-animate-delay","0.5s"),$("#areaName").attr("swiper-animate-duratio","2s"),$("#areaName").attr("swiper-animate-delay","1s"),$("#dy_img").removeClass("dy_img animateTimeImg"),$("#dy_name").removeClass("dy_name animateTimeName")),2==a.activeIndex?(thrHtml(arr_1,"田间管理",!0),$(".thr .administration-children-img").addClass("administrationAnimation")):$(".thr .administration-children-img").removeClass("administrationAnimation")}});dataObj.aaData&&(dataObj.aaData.ltxx.length>0||dataObj.aaData.ncqh[0]||dataObj.aaData.nw.length>0||a.disableTouchControl())}function map(){AMapUI.loadUI(["control/BasicControl","overlay/SimpleMarker"],function(a,e){var t=new a.LayerSwitcher({theme:"transparent",baseLayers:[{enable:!0,id:"satellite",name:"图层B",layer:new AMap.TileLayer.Satellite}],overlayLayers:[{id:"roadNet",name:"图层D",enable:!1,layer:new AMap.TileLayer.RoadNet}]}),n=new AMap.Map("container",{resizeEnable:!0,center:[104.06,33.67],zoom:1,layers:t.getEnabledLayers()});if(n.addControl(t),n.setStatus({dragEnable:!1}),n.setStatus({doubleClickZoom:!1}),dataObj.aaData.nodeInfo.length>0)new AMap.Marker({map:n,position:[dataObj.aaData.nodeInfo[0].gisX,dataObj.aaData.nodeInfo[0].gisY]});n.on("complete",function(){$(".amap-icon").offset()?$("#areaName").css({top:$(".amap-icon").offset().top+$(".amap-icon").height()+5+"px",left:$(".amap-icon").offset().left-$("#areaName").width()/2+6+"px"}):($("#areaName").css({top:"5.6rem",left:"2.6rem"}),console.log("nodeInfo为空或者未找到nodeInfo的经纬度"),dataObj.aaData.nodeInfo.length>0&&$("#areaName").html("该地理位置不在此地图上"),$("#headerRightImg").css({display:"none"})),$(".amap-icon").attr("swiper-animate-effect","bounceInDown"),$(".amap-icon").attr("swiper-animate-duratio","2.1s"),$(".amap-icon").attr("swiper-animate-delay","3.5s"),$(".amap-icon").addClass("ani"),$("#areaName").attr("swiper-animate-effect","bounceInLeft"),$("#areaName").attr("swiper-animate-duratio","2.1s"),$("#areaName").attr("swiper-animate-delay","4s"),setTimeout(function(){$(".amap-icon").css({display:"none"}),$("#areaName").css({display:"none"})},5800),animateSwiper()})})}function myAJAX(){getDataList(API_URL+"importantGood/queryInfoByTranId",{tranId:tranId},function(a){if(a&&0===a.state){dataObj=a,firstHtml(a);for(var e=0;e<a.aaData.nw.length;e++)"4"==a.aaData.nw[e].farm_type?arr_2.push(a.aaData.nw[e]):"5"==a.aaData.nw[e].farm_type?arr_3.push(a.aaData.nw[e]):arr_1.push(a.aaData.nw[e]);thrHtml(arr_1,"田间管理",!0)}map()})}function firstHtml(a){if(a.aaData.zycpcx[0]){var e=a.aaData.zycpcx[0];$("#baseName").html(e.baseName),$("#nodename").html(e.nodeName),$("#inDate").html(e.inDate.split(" ")[0]),$("#plantDate").html(e.plantDate),$("#precipitation").html(e.precipitation+"%"),e.goodsDes?$("#first_p").html(e.goodsDes):$("#first_p").html(""),e.goodsName?$("#goodsName").html(e.goodsName):$("#goodsName").html("goodsName为空")}a.aaData.quarantineinfo&&a.aaData.quarantineinfo.length>0&&(null===a.aaData.quarantineinfo.pesticide?$("#pesticide").html("0%"):$("#pesticide").html(a.aaData.quarantineinfo[0].pesticide+"%")),a.aaData.goodProduct&&a.aaData.goodProduct.length>0?$("#first_img").attr({src:IMG_URL+a.aaData.goodProduct[0].imageUrl}):$("#first_img").attr({src:IMG_URL+""}),a.aaData.nodeInfo.length>0?($("#headerRightText").html(a.aaData.nodeInfo[0].areaName),$("#areaName").html(a.aaData.nodeInfo[0].areaName)):$("#areaName").html("未获取到地理位置信息")}function thrHtml(a,e,t){$("#headerTj").html(e);var n=[];n=a.slice(0,3);for(var i=0;i<3;i++)$("#is_show_"+i).css({display:"none"}),$("#is_show_"+i).attr({"swiper-animate-delay":"0s"});if("田间管理"==e&&t)var s="animated_ajax_";else s="";if(n){for(var r="",o=0;o<n.length;o++){if(n[o].f_inputs_name||(n[o].f_inputs_name="无"),o%2==0)l='<div  class="tj-message-1 ani '+s+o+' " swiper-animate-effect="bounceInLeft" swiper-animate-duration="1s" swiper-animate-delay="1s"><div class="tj-message-1-1 ani "><div><span>'+n[o].farm_type_name+"</span> <span>"+n[o].f_indate.split(" ")[0]+"</span></div><p>操作人：<span>"+n[o].f_operator+"</span>；投入品名称：<span >"+n[o].f_inputs_name+"</span>；用量：<span >"+n[o].f_mu_usage+"</span>；使用方式：<span >"+n[o].f_usage_method+"</span>。</p></div><img src="+IMG_URL+n[o].f_image_url+' class="tj-message-1-img ani" swiper-animate-effect="bounceInRight" swiper-animate-duration="1s" swiper-animate-delay="0.8s"  alt="" /><div class="tj-message-1-radius ani" swiper-animate-effect="bounceInRight" swiper-animate-duration="1s" swiper-animate-delay="0.8s">'+(o+1)+"</div></div>";else var l='<div  class="tj-message-1 ani '+s+o+'" swiper-animate-effect="bounceInRight" swiper-animate-duration="1s" swiper-animate-delay="1.2s"><div swiper-animate-effect="bounceInRight" swiper-animate-duration="1s" swiper-animate-delay="0.8s" class="tj-message-1-radius ani tj-message-right-radius">2</div><img src='+IMG_URL+n[o].f_image_url+' swiper-animate-effect="bounceInRight" swiper-animate-duration="1s" swiper-animate-delay="0.8s" class="tj-message-1-img ani tj-message-right-img" alt="" /><div swiper-animate-effect="bounceInRight" swiper-animate-duration="1s" swiper-animate-delay="0.8s" class="tj-message-1-1 ani"><div class="twoName"><span >'+n[o].farm_type_name+"</span> <span >"+n[o].f_indate.split(" ")[0]+'</span></div><p class="tj-message-right-p">操作人：<span>'+n[o].f_operator+"</span>；投入品名称：<span >"+n[o].f_inputs_name+"</span>；用量：<span >"+n[o].f_mu_usage+"</span>；使用方式：<span >"+n[o].f_usage_method+"</span>。</p></div></div>";r+=l}$("#tj-message").html(r)}}function thrBtn(a){$(a).addClass("yy-color").siblings().removeClass("yy-color");var e=$(a).html();"田间管理"==e?thrHtml(arr_1,e,!1):"施肥管理"==e?thrHtml(arr_2,e,!1):"用药管理"==e&&thrHtml(arr_3,e,!1)}function loading_num(){var a=0,e=setInterval(function(){a>=100?(clearInterval(e),a=100,setTimeout(function(){$(".loading").fadeOut(500)},1e3)):a++,$("#loading_num").html(a+"%")},20)}function getAllDataList(){getDataList(API_URL+"importantGood/queryInfoByTranId",{tranId:tranId},function(a){a&&0===a.state&&(a.aaData.ncqh[0]&&(renderFarmClimate(a.aaData.ncqh[0]),renderBaseInfo(a.aaData.ncqh[0])),a.aaData.ltxx&&a.aaData.ltxx.length>0&&renderXsjlList(a.aaData.ltxx))})}function renderFarmClimate(a){var e=$("#farmClimateView"),t=$("#farmClimateTpl").html();$(".climate-data").html(a.f_ave_temperature+"℃"),laytpl(t).render(a,function(t){e.html(t);var n=0,i=$(".climate-type").children("div"),s=["imgs/two_icon_wendu.png","imgs/two_icon_haiba.png","imgs/four_icon_jiangshui.png"],r=["年平均温度","海拔","年平均降水量"],o=[a.f_ave_temperature+"℃",a.f_altitude+"m",a.f_precipitation+"ml"];setInterval(function(){++n>=i.length&&(n=0),i.eq(n).addClass("active").siblings("").removeClass("active"),$(".climate-img>img").attr("src",s[n]),$(".climate-data").html(o[n]),$("#climate-text").html(r[n])},2500)})}function renderBaseInfo(a){if(a.f_image_url)e=IMG_URL+a.f_image_url;else var e="imgs/img_moren.png";$("#jdimg>img").attr("src",e);var t=$("#baseinfoView"),n=$("#baseinfoTpl").html();laytpl(n).render(a,function(a){t.html(a)})}function renderXsjlList(a){var e=["one","two","three","four","five","six","seven","eight","nine","ten"],t=a.length,n=$("#salerecordView");$("#salerecordTpl").html();a.reverse(),e=e.slice(0,t).reverse();for(var i="",s=1,r=1.4,o="",l=0;l<a.length;l++){var m="",d="";if(o=l%2==0?"采收时间：":"进场日期：",l>=1)for(var c=1;c<2;c++)d='<li><span class="yellow_spot ani" swiper-animate-effect="bounceInDown" swiper-animate-duration="1s" swiper-animate-delay='+s+'s></span><div class="text ani" swiper-animate-effect="bounceInLeft" swiper-animate-duration="1s" swiper-animate-delay='+r+'s><p>批次号</p><p class="span">'+a[l][e[l]].batchId+'</p><p>交易凭证号</p><p class="span">'+a[l][e[l]].transId+"</p></div></li>",s+=.8,r+=.8;m='<li><span class="yellow_spot ani" swiper-animate-effect="bounceInDown" swiper-animate-duration="1s" swiper-animate-delay='+s+'s></span><div class="text ani" swiper-animate-effect="bounceInRight" swiper-animate-duration="1s" swiper-animate-delay='+r+"s><p>"+a[l][e[l]].salermarketName+"</p><p>"+o+a[l][e[l]].indate.split(" ")[0]+"</p></div></li>",s+=.8,r+=.8,i=i+d+m}n.html(i),a[0][e[0]].goodsName?$("#ltxxgoodsName").html(a[0][e[0]].goodsName):$("#ltxxgoodsName").html("goodsName为空");var p=6/n.children().length;n.children().css({height:p+"rem"});for(var f=0;f<$("#salerecordView li .text").length;f++)$("#salerecordView li .text")[f].style="top:0;bottom:0;margin:auto;height:"+$("#salerecordView li .text")[f].offsetHeight+"px"}var tranId=GetRequest().tranId||"37068100000000000998";"临沂"==AREANAME?$(".slide-page2").css({background:"url(imgs/two_line1.png) no-repeat",backgroundSize:"cover"}):"烟台"==AREANAME&&$(".slide-page2").css({background:"url(imgs/two_line.png) center",backgroundSize:"cover"});var getDataList=function(a,e,t){$.ajax({type:"GET",url:a,data:e,success:function(a){t&&t(a)},error:function(a){console.log(JSON.stringify(a))}})};$(function(){myAJAX()});var dataObj={},oddActiveIndex=0,arr_1=[],arr_2=[],arr_3=[];$(function(){new Swiper(".banner-container",{pagination:".banner-pagination",paginationClickable:!0});getAllDataList(),loading_num()}),console.log("test");